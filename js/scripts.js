(function(a){a.gallereo=function(e){var d="no-touch",g=a(document),f=gallereo.l10n;if("ontouchstart" in document.documentElement){window.scrollTo(0,1);d="touch"}a("#gallereo-zoomview").remove();a("body").prepend('<div id="gallereo-zoomview" class="'+d+'"><a href="javascript:;" id="gallereo-zoomclose" title="'+f.close+'">'+f.close+'</a><a href="javascript:;" rel="previous" id="gallereo-previous" class="gallereo-zoomarrow" title="'+f.previous+'">'+f.previous+'</a><a href="javascript:;" rel="next" id="gallereo-next" class="gallereo-zoomarrow" title="'+f.next+'">'+f.next+'</a><div id="gallereo-zoomscroll"><ul id="gallereo-zoom"></ul></div></div>');var c=function(i,h){var j=this;j._container=i;j._images=h;j._imgArray=[];j._titleArray=[];j._idx=0;j._zoomIdx=null;j._zoomImagesLoaded=[];j._zoomScrollDir=null;j._zoomScrollLeft=0;j._render()};c.prototype={_processImages:function(n){var v=this,s=v._images,o=0,l=0,u=v._container.width(),h=0,w=0,q=0,r=0,t=0;for(var p=0;p<s.length;p++){h+=s[p].height}h=Math.round(h/s.length);for(p=0;p<s.length;p++){s[p].width=Math.floor(h*s[p].width/s[p].height);s[p].height=h;s[p].cwidth=s[p].width;l+=s[p].width+n*2;if(u<=l){t=0;w=p-(o-1);r=l-u-n*w*2;q=Math.floor(r/w);for(var m=o;m<=p;m++){if(m<p){q=Math.floor(r*s[m].width/l);t+=q}else{q=r-t}s[m].cwidth=s[m].width-q-n*2-1;s[m].imargin=Math.floor(-q/2)}o=p+1;l=0}}return h},_render:function(){var k=this,h=k._images,m=1,j=0;j=k._processImages(m);k._container.empty();for(var l=0;l<h.length;l++){k._container.append(a("<a></a>").append(a("<img>").attr("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==").attr("width",h[l].width).attr("height",h[l].height).attr("data-original",h[l].url).height(h[l].height).width(h[l].width).css("margin-left",h[l].imargin+"px")).attr("href",h[l].link).data("index",l).css("overflow","hidden").css("float","left").css("margin",m+"px").height(h[l].height).width(h[l].cwidth).click(function(i){i.preventDefault();k.loadZoom(a(this).data("index"))}));k._imgArray.push(h[l].link);k._titleArray.push('<span class="gallereo-zoomcaption-title">'+h[l].title+"</span>"+h[l].description)}k._container.append(a("<div></div>").css("clear","both"));k._container.find("img").lazyload({threshold:j,effect:"fadeIn",event:"sporty"}).trigger("sporty")},loadZoom:function(i){var l=this,h="",k,j;l._zoomIdx=i;j=a(window).width();k=parseInt(i*j);a("#gallereo-previous").toggle(i!=0);a("#gallereo-next").toggle(i!=l._imgArray.length-1);a("#gallereo-zoom").width(l._imgArray.length*j);g.on("click",".gallereo-zoomarrow",function(m){m.preventDefault();l.prevNext(this.rel)});g.on("click","#gallereo-zoomclose",function(m){m.preventDefault();l.unloadZoom()});g.on("click","#gallereo-zoomview",function(m){if(m.target.tagName.toLowerCase()!="a"){m.preventDefault();l.unloadZoom()}});g.on("click","#gallereo-zoomslide",function(){l.unloadZoom()});g.on("click",".gallereo-zoomimg",function(){return false});a("#gallereo-zoomview").addClass("fixed").fadeIn(function(){a(window).on("resize",function(){l.resizeZoom()});a.each(l._imgArray,function(m){h+='<li class="gallereo-zoomslide loading" id="gallereo-zoomslide'+m+'" style="width: '+j+'px;"><img src="'+gallereo.path.images+'square.gif" class="gallereo-zoomspacer"><div class="gallereo-zoomcaption">'+l._titleArray[m]+"</div></li>"});a("#gallereo-zoom").html(h);l.zoomKeyPress();a("#gallereo-zoomscroll").scrollLeft(k);l._zoomScrollLeft=k;l.loadZoomImg(i);l.zoomScroll();if((i-1)>=0){l.loadZoomImg(i-1)}if((i+1)<l._imgArray.length){l.loadZoomImg(i+1)}})},resizeZoom:function(){var i=this,h;h=a(window).width();a("#gallereo-zoom").width(i._imgArray.length*h);a(".gallereo-zoomslide").width(h);a("#gallereo-zoomscroll").scrollLeft(parseInt(i._zoomIdx*h))},zoomKeyPress:function(){var h=this;g.on("keyup","body",function(i){switch(i.which){case 27:h.unloadZoom();break;case 37:h.prevNext("previous");break;case 39:h.prevNext("next");break}})},loadZoomImg:function(h){var i=this;if(a("#gallereo-zoomimg"+h).length===0){a("#gallereo-zoomslide"+h+" .gallereo-zoomspacer").after('<img src="'+i._imgArray[h]+'" data-src="'+i._imgArray[h]+'" id="gallereo-zoomimg'+h+'" class="gallereo-zoomimg">');a("#gallereo-zoomimg"+h).load(function(){a(this).addClass("active")})}},zoomScroll:function(){var h=this,i=true,j;a("#gallereo-zoomscroll").on("scroll",function(){var k=a(window).width();j=a(this).scrollLeft();if(i){i=false;setTimeout(function(){a("#gallereo-previous").fadeTo(0,j==0?0:1);a("#gallereo-next").fadeTo(0,j>=(h._images.length-1)*k?0:1);if(j%h._zoomScrollLeft>20||(j>0&&h._zoomScrollLeft===0)){h._zoomScrollLeft=j;var m=h._zoomScrollLeft/k;var n=Math.ceil(m);var l=Math.floor(m);if(!h._zoomImagesLoaded[n]){h.loadZoomImg(n)}if(!h._zoomImagesLoaded[l]){h.loadZoomImg(l)}}i=true},200)}})},unloadZoom:function(){g.off("keyup","body");g.off("click",".gallereo-zoomarrow, .gallereo-zoomclose, #gallereo-zoomview, #gallereo-zoomslide, .gallereo-zoomimg");a(window).off("resize",this.resizeZoom);a("#gallereo-zoomscroll").off("scroll");a("#gallereo-zoomview").fadeOut(function(){a("#gallereo-zoom").empty();a(this).off("keyup").removeClass("fixed")})},prevNext:function(j){var i=this,h=a(window).width();i._zoomIdx=Math.round(a("#gallereo-zoomscroll").scrollLeft()/h)+(j=="previous"?-1:1);a("#gallereo-zoomscroll").stop().animate({scrollLeft:i._zoomIdx*h})}};a.each(e,function(i,h){new c(a("#"+i),h)})};function b(){if(window.gallereo||window.gallereo.data){a.gallereo(gallereo.data)}}a(document).ready(function(){var d,e=a(window),c=e.width();e.resize(function(){var f=e.width();if(f!=c){clearTimeout(d);d=setTimeout(b,100);c=f}});b()})})(jQuery);